<button id="open-sidebar-button" (click)="openSidebar()" #openSidebarButton aria-label="open sidebar" aria-expanded="false"
    aria-controls="navbar">
    <mat-icon class="svg" aria-hidden="false" aria-label="icon" >menu</mat-icon>
</button>

<nav id="navbar" #navbar>
    <ul>
        <li>
            <button id="close-sidebar-button" (click)="closeSidebar()" #closeSidebarButton aria-label="close sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px"
                    fill="#c9c9c9">
                    <path
                        d="m480-444.62-209.69 209.7q-7.23 7.23-17.5 7.42-10.27.19-17.89-7.42-7.61-7.62-7.61-17.7 0-10.07 7.61-17.69L444.62-480l-209.7-209.69q-7.23-7.23-7.42-17.5-.19-10.27 7.42-17.89 7.62-7.61 17.7-7.61 10.07 0 17.69 7.61L480-515.38l209.69-209.7q7.23-7.23 17.5-7.42 10.27-.19 17.89 7.42 7.61 7.62 7.61 17.7 0 10.07-7.61 17.69L515.38-480l209.7 209.69q7.23 7.23 7.42 17.5.19 10.27-7.42 17.89-7.62 7.61-17.7 7.61-10.07 0-17.69-7.61L480-444.62Z" />
                </svg>
            </button>
        </li>
        
        <!-- Botón de Notificaciones -->
        <li class="notifications-container" *ngIf="!(mediaQuery$ | async)">
            <button class="notifications-btn" (click)="toggleNotificationsPanel()"
                    [attr.aria-expanded]="notificationsPanelOpen"
                    aria-label="notificaciones">
                <mat-icon aria-hidden="false"
                          [matBadge]="totalNotifications" 
                          matBadgeColor="warn" 
                          [matBadgeHidden]="totalNotifications === 0">notifications</mat-icon>
            </button>
        </li>
    </ul>
</nav>

<aside class="notifications-panel" [class.open]="notificationsPanelOpen" aria-label="Panel de notificaciones">
    <div class="panel-header">
        <span class="panel-title">Notificaciones</span>
        <button class="close-panel-btn" (click)="closeNotificationsPanel()" aria-label="cerrar panel">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- Filtros tipo Chips -->
    <div class="filter-chips">
        <button class="chip" 
                [class.active]="selectedFilter === null" 
                (click)="selectFilter(null)"
                aria-label="mostrar todas las notificaciones">
            Todas
        </button>
        @for (section of notificationSections; track section.id) {
            <button class="chip" 
                    [class.active]="selectedFilter === section.id"
                    (click)="selectFilter(section.id)"
                    [attr.aria-label]="'filtrar por ' + section.name">
                <mat-icon class="chip-icon">{{section.icon}}</mat-icon>
                <span>{{section.name}}</span>
            </button>
        }
    </div>

    <div class="panel-content">
        @for (section of filteredSections; track section.id) {
            <div class="panel-section">
                <div class="section-header">
                    <mat-icon>{{section.icon}}</mat-icon>
                    <span class="section-title">{{section.name}}</span>
                    <span class="badge" *ngIf="section.notifications.length > 0">
                        {{section.notifications.length}}
                    </span>
                    <button class="section-clear-btn" *ngIf="section.notifications.length > 0"
                        (click)="clearSection(section.id)" aria-label="limpiar sección">
                        <mat-icon>clear_all</mat-icon>
                    </button>
                </div>

                @if (section.notifications.length > 0) {
                    <div class="section-items">
                        @for (notification of section.notifications; track notification.id) {
                            <button class="notification-item" (click)="markAsRead(notification.id)">
                                <span class="notification-title">{{notification.title}}</span>
                                <span class="notification-time">{{notification.timestamp | date:'short'}}</span>
                            </button>
                        }
                    </div>
                } @else {
                    <div class="section-empty">Sin notificaciones</div>
                }
            </div>
        }

        @if (totalNotifications > 0) {
            <div class="panel-actions">
                <button class="clear-all-btn" (click)="clearAllNotifications()">
                    <mat-icon>delete_sweep</mat-icon>
                    <span>Limpiar todas</span>
                </button>
            </div>
        }
    </div>
</aside>

<div id="overlay" (click)="closeSidebar()" #overlay aria-hidden="true"></div>